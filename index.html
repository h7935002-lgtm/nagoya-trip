<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MIMON-NAGOYA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary-color: #5856D6;
            --bg-color: #F2F2F7;
            --card-bg: #FFFFFF;
            --danger-color: #FF3B30;
            --success-color: #34C759;
            --link-color: #007AFF;
            --text-gray: #8E8E93;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0; 
            padding-bottom: 90px; /* ç•™çµ¦åº•éƒ¨å°èˆªç©ºé–“ */
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }

        /* --- é ‚éƒ¨ Header --- */
        .header {
            background: var(--primary-color); color: white;
            padding: 20px 20px 10px 20px;
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .trip-title { font-size: 22px; font-weight: 800; }
        
        /* ç·¨è¼¯æŒ‰éˆ• */
        .edit-toggle {
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4);
            color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px;
            cursor: pointer; display: flex; align-items: center; gap: 5px;
        }
        .edit-toggle.editing { background: var(--success-color); border-color: transparent; }

        /* --- é é¢åˆ‡æ›é¡¯ç¤º --- */
        .page-view { display: none; animation: fadeIn 0.3s; }
        .page-view.active { display: block; }

        /* --- è¡Œç¨‹è¡¨æ¨£å¼ (Itinerary) --- */
        .tabs { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; scrollbar-width: none; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab-btn {
            background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 8px 16px; border-radius: 12px; min-width: 55px;
            display: flex; flex-direction: column; align-items: center;
            cursor: pointer; transition: 0.2s; flex-shrink: 0;
        }
        .tab-btn.active { background: white; color: var(--primary-color); font-weight: bold; }
        .tab-date { font-size: 10px; margin-bottom: 2px; }
        .tab-day { font-size: 16px; }

        .content { padding: 20px; min-height: 300px; }
        .timeline-item { position: relative; padding-left: 30px; margin-bottom: 20px; }
        .timeline-item::before {
            content: ''; position: absolute; left: 7px; top: 15px; bottom: -25px; width: 2px; background: #D1D1D6;
        }
        .timeline-item:last-child::before { display: none; }
        .timeline-item::after {
            content: ''; position: absolute; left: 0; top: 15px; width: 16px; height: 16px;
            background: var(--primary-color); border-radius: 50%; border: 3px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card {
            background: var(--card-bg); border-radius: 16px; padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column; gap: 10px; /* æ”¹ç‚ºå‚ç›´æ’åˆ—ä»¥å®¹ç´ Memo */
            position: relative;
        }
        .card-main { display: flex; align-items: flex-start; gap: 15px; width: 100%; }

        .time-box { text-align: center; min-width: 50px; }
        .time-box .ampm { font-size: 10px; color: #8E8E93; }
        .time-box .time { font-size: 16px; font-weight: 700; color: #333; }
        
        .info-box { flex: 1; min-width: 0; }
        .info-title { font-size: 16px; font-weight: 600; color: #000; margin-bottom: 4px; line-height: 1.4; }
        .loc-wrapper { display: flex; align-items: center; gap: 8px; flex-wrap: wrap;}
        .info-loc { font-size: 12px; color: #8E8E93; display: flex; align-items: center; gap: 4px; }
        .info-note { font-size: 12px; color: #FF9500; margin-top: 4px; line-height: 1.3; }
        
        /* å°èˆªæŒ‰éˆ• */
        .map-link {
            display: inline-flex; align-items: center; gap: 3px;
            background: rgba(0, 122, 255, 0.1); color: var(--link-color);
            padding: 2px 8px; border-radius: 6px; font-size: 11px;
            text-decoration: none; font-weight: 600; white-space: nowrap;
        }

        /* --- æ–°å¢åŠŸèƒ½ï¼šMemo å‚™å¿˜éŒ„ --- */
        .memo-section {
            width: 100%;
            background: #FFF9E6; /* æ·¡é»ƒè‰²ä¾¿æ¢ç´™æ„Ÿ */
            padding: 10px; border-radius: 8px;
            border-left: 3px solid #FFCC00;
            font-size: 13px; color: #555; line-height: 1.5;
            display: none; /* é è¨­éš±è—ï¼Œæœ‰å…§å®¹æ‰é¡¯ç¤º */
            margin-top: 5px;
            white-space: pre-wrap; /* ä¿ç•™æ›è¡Œ */
        }
        .memo-section.show { display: block; }
        
        /* Memo æ§åˆ¶æŒ‰éˆ• (åƒ…ç·¨è¼¯æ¨¡å¼é¡¯ç¤º) */
        .memo-controls { display: none; gap: 10px; margin-top: 5px; font-size: 12px; }
        .add-memo-btn { color: var(--link-color); cursor: pointer; border: 1px dashed var(--link-color); padding: 4px 8px; border-radius: 4px; display: inline-block;}
        .del-memo-btn { color: var(--danger-color); cursor: pointer; display: inline-block; margin-left: auto;}
        
        body.is-editing .memo-controls { display: flex; }
        body.is-editing .memo-section { display: block !important; min-height: 40px; border: 1px dashed #ccc; background: #fff;} /* ç·¨è¼¯æ™‚å¼·åˆ¶é¡¯ç¤º */

        /* --- æª¢æŸ¥æ¸…å–®æ¨£å¼ (Checklist) --- */
        .checklist-container { padding: 20px; }
        .checklist-category { margin-bottom: 25px; background: white; border-radius: 16px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .cat-title { font-size: 18px; font-weight: 700; color: var(--primary-color); margin-bottom: 10px; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        
        .check-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f9f9f9; }
        .check-item:last-child { border-bottom: none; }
        
        /* è‡ªå®šç¾© Checkbox */
        .custom-checkbox {
            width: 22px; height: 22px; border: 2px solid #ddd; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; flex-shrink: 0;
        }
        .custom-checkbox i { color: white; font-size: 12px; display: none; }
        .check-item.checked .custom-checkbox { background: var(--success-color); border-color: var(--success-color); }
        .check-item.checked .custom-checkbox i { display: block; }
        .check-item.checked .item-text { text-decoration: line-through; color: #ccc; }
        .item-text { flex: 1; font-size: 15px; }

        /* æ¸…å–®ç·¨è¼¯åŠŸèƒ½ */
        .del-check-btn { color: var(--danger-color); font-size: 14px; padding: 5px; display: none; }
        .add-check-row { display: none; text-align: center; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; }
        .add-check-btn { color: var(--link-color); font-size: 14px; cursor: pointer; }
        
        body.is-editing .del-check-btn { display: block; }
        body.is-editing .add-check-row { display: block; }
        body.is-editing .item-text { border-bottom: 1px dashed #ccc; background: rgba(0,0,0,0.02); padding: 2px; }

        /* --- åº•éƒ¨å°èˆªåˆ— --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-top: 1px solid #e0e0e0;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 900;
        }
        .nav-item {
            flex: 1; text-align: center; color: var(--text-gray); cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
        }
        .nav-item i { font-size: 20px; }
        .nav-item span { font-size: 10px; font-weight: 500; }
        .nav-item.active { color: var(--primary-color); }

        /* --- é€šç”¨ç·¨è¼¯æ¨£å¼ --- */
        body.is-editing .time, body.is-editing .info-title, body.is-editing .info-loc, body.is-editing .info-note, body.is-editing .ampm {
            border-bottom: 1px dashed #ccc; background: rgba(0,0,0,0.02) !important; padding: 2px;
        }
        body.is-editing .map-link { display: none; }
        .delete-btn {
            position: absolute; right: -10px; top: -10px;
            background: var(--danger-color); color: white; width: 24px; height: 24px;
            border-radius: 50%; display: none; justify-content: center; align-items: center;
            cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;
        }
        body.is-editing .delete-btn { display: flex; }
        .add-btn-container { text-align: center; margin-top: 20px; display: none; }
        body.is-editing .add-btn-container { display: block; }
        .add-btn {
            background: var(--primary-color); color: white; border: none;
            padding: 10px 20px; border-radius: 20px; font-size: 14px;
            box-shadow: 0 4px 10px rgba(88, 86, 214, 0.3);
        }
        #save-toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px;
            border-radius: 30px; font-size: 12px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 1000;
        }
        #save-toast.show { opacity: 1; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-top">
            <div class="trip-title" contenteditable="false">ğŸ‡¯ğŸ‡µ åå¤å±‹ãƒ»ç™½å·é„‰</div>
            <button class="edit-toggle" onclick="toggleEditMode()">
                <i class="fas fa-pen"></i> <span id="editBtnText">ç·¨è¼¯</span>
            </button>
        </div>
        
        <div id="itinerary-tabs" class="tabs">
            <button class="tab-btn active" onclick="switchDay('d1', this)"><span class="tab-date">é€±å››</span><span class="tab-day">D1</span></button>
            <button class="tab-btn" onclick="switchDay('d2', this)"><span class="tab-date">é€±äº”</span><span class="tab-day">D2</span></button>
            <button class="tab-btn" onclick="switchDay('d3', this)"><span class="tab-date">é€±å…­</span><span class="tab-day">D3</span></button>
            <button class="tab-btn" onclick="switchDay('d4', this)"><span class="tab-date">é€±æ—¥</span><span class="tab-day">D4</span></button>
            <button class="tab-btn" onclick="switchDay('d5', this)"><span class="tab-date">é€±ä¸€</span><span class="tab-day">D5</span></button>
            <button class="tab-btn" onclick="switchDay('d6', this)"><span class="tab-date">é€±äºŒ</span><span class="tab-day">D6</span></button>
        </div>
        
        <div id="checklist-header" style="display:none; color:white; font-size:14px; opacity:0.9;">
            å‡ºç™¼å‰è¨˜å¾—æª¢æŸ¥è¡Œæå–”ï¼ğŸ’
        </div>
    </div>

    <div id="view-itinerary" class="page-view active">
        <div class="content" id="schedule-container"></div>
        <div class="add-btn-container"><button class="add-btn" onclick="addNewItem()"><i class="fas fa-plus"></i> æ–°å¢è¡Œç¨‹</button></div>
    </div>

    <div id="view-checklist" class="page-view">
        <div class="checklist-container" id="checklist-container">
            </div>
    </div>

    <div id="save-toast"><i class="fas fa-check"></i> å·²è‡ªå‹•å„²å­˜</div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchPage('itinerary', this)">
            <i class="fas fa-map-marked-alt"></i>
            <span>è¡Œç¨‹</span>
        </div>
        <div class="nav-item" onclick="switchPage('checklist', this)">
            <i class="fas fa-clipboard-check"></i>
            <span>æ¸…å–®</span>
        </div>
    </div>

    <script>
        // --- 1. è³‡æ–™çµæ§‹åˆå§‹åŒ– ---
        const defaultData = {
            // è¡Œç¨‹è³‡æ–™ (ä¿ç•™ V4 çš„è³‡æ–™)
            itinerary: {
                d1: [
                    { id: 101, ampm: "ä¸Šåˆ", time: "11:00", title: "æŠµé”æ¡ƒåœ’æ©Ÿå ´", loc: "æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ", note: "æº–å‚™ Check-in", memo: "è¨˜å¾—å¸¶è­·ç…§ï¼Œéš¨èº«é›»æºæ”¾èƒŒåŒ…" },
                    { id: 102, ampm: "ä¸‹åˆ", time: "15:00", title: "é£›å¾€ä¸­éƒ¨åœ‹éš›ç©ºæ¸¯", loc: "ä¸­éƒ¨åœ‹éš›ç©ºæ¸¯", note: "18:30 æŠµé”" },
                    { id: 103, ampm: "æ™šä¸Š", time: "20:00", title: "é£¯åº— Check-in", loc: "BASE LAYER Hotel", note: "æ”¾è¡Œæã€ä¼‘æ¯" }
                ],
                d2: [
                    { id: 201, ampm: "ä¸Šåˆ", time: "07:30", title: "JR é£›é©’è™Ÿåˆ—è»Š", loc: "åå¤å±‹è»Šç«™", note: "è»Šç¨‹ç´„ 2.5 å°æ™‚" },
                    { id: 203, ampm: "ä¸­åˆ", time: "11:45", title: "ç™½å·é„‰ åˆæŒæ‘", loc: "ç™½å·é„‰åˆæŒæ‘", note: "åˆé¤ & è§€å…‰è‡³ 18:00" }
                ],
                d3: [], d4: [], d5: [], d6: [] // ç‚ºç¯€çœç¯‡å¹…ï¼Œå…¶ä»–å¤©è‹¥ç‚ºç©ºæœƒè‡ªå‹•ç”¢ç”Ÿ
            },
            // æª¢æŸ¥æ¸…å–®è³‡æ–™
            checklist: [
                {
                    category: "å¿…å‚™è­‰ä»¶ & éŒ¢åŒ…",
                    items: [
                        { text: "è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)", checked: false },
                        { text: "VJW å…¥å¢ƒæˆªåœ– / QR code", checked: false },
                        { text: "æ—¥å¹£ç¾é‡‘ / ä¿¡ç”¨å¡", checked: false },
                        { text: "æ©Ÿç¥¨ / è¨‚æˆ¿ç¢ºèªå–®", checked: false }
                    ]
                },
                {
                    category: "è¡£ç‰© & ç©¿æˆ´",
                    items: [
                        { text: "æ›æ´—è¡£ç‰© (5å¤©ä»½)", checked: false },
                        { text: "ç™¼ç†±è¡£ / ç¾½çµ¨å¤–å¥—", checked: false },
                        { text: "å¥½èµ°çš„é‹å­", checked: false }
                    ]
                },
                {
                    category: "é›»å­ç”¢å“",
                    items: [
                        { text: "æ‰‹æ©Ÿ / å……é›»ç·š", checked: false },
                        { text: "è¡Œå‹•é›»æº (éœ€éš¨èº«å¸¶)", checked: false },
                        { text: "ç¶²å¡ / Wi-Fi æ©Ÿ", checked: false },
                        { text: "è½‰æ¥é ­ (æ—¥æœ¬é›™å­”)", checked: false }
                    ]
                },
                {
                    category: "è—¥å“ & é›œç‰©",
                    items: [
                        { text: "å¸¸å‚™è—¥ (æ„Ÿå†’/è…¸èƒƒ)", checked: false },
                        { text: "æ‘ºç–Šå‚˜", checked: false },
                        { text: "ç‰™åˆ· / ç›¥æ´—ç”¨å“", checked: false }
                    ]
                }
            ]
        };

        // è£œè¶³ V4 è³‡æ–™ (è‹¥æ‚¨ä½¿ç”¨èˆŠè³‡æ–™)
        const fullDefaultData = JSON.parse(JSON.stringify(defaultData)); 
        // é€™è£¡å¯ä»¥æŠŠæ‚¨ä¸Šä¸€ç‰ˆå®Œæ•´çš„è¡Œç¨‹è²¼é€²å» itinerary å€å¡Šï¼Œç‚ºäº†ä»£ç¢¼ç°¡æ½”æˆ‘åªæ”¾éƒ¨åˆ†ç¯„ä¾‹

        let currentDay = 'd1';
        let isEditing = false;
        let appData = {};

        // --- 2. åˆå§‹åŒ– ---
        window.onload = function() { 
            loadData(); 
            renderSchedule(); 
            renderChecklist();
        };

        // é˜²æ­¢è²¼ä¸Šæ ¼å¼è·‘ç‰ˆ
        document.addEventListener('paste', function (e) {
            if (e.target.isContentEditable) {
                e.preventDefault();
                const text = (e.clipboardData || window.clipboardData).getData('text');
                document.execCommand('insertText', false, text);
            }
        });

        function loadData() {
            const saved = localStorage.getItem('myTripData_v5');
            if (saved) {
                appData = JSON.parse(saved);
                // ç›¸å®¹æ€§æª¢æŸ¥ï¼šå¦‚æœèˆŠè³‡æ–™æ²’æœ‰ checklistï¼Œè£œä¸Šå»
                if (!appData.checklist) appData.checklist = defaultData.checklist;
                if (!appData.itinerary) {
                     // å¯èƒ½æ˜¯ V4 æ ¼å¼ï¼Œè½‰æ›ä¸€ä¸‹
                     const oldData = JSON.parse(saved);
                     appData = { itinerary: oldData, checklist: defaultData.checklist };
                }
            } else {
                appData = JSON.parse(JSON.stringify(defaultData));
            }
        }

        function saveData() {
            localStorage.setItem('myTripData_v5', JSON.stringify(appData));
            showToast();
        }

        // --- 3. é é¢åˆ‡æ› ---
        function switchPage(pageName, navBtn) {
            // åˆ‡æ› Nav æ¨£å¼
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            navBtn.classList.add('active');

            // åˆ‡æ›é é¢å…§å®¹
            document.querySelectorAll('.page-view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + pageName).classList.add('active');

            // åˆ‡æ› Header é¡¯ç¤º
            if(pageName === 'itinerary') {
                document.getElementById('itinerary-tabs').style.display = 'flex';
                document.getElementById('checklist-header').style.display = 'none';
            } else {
                document.getElementById('itinerary-tabs').style.display = 'none';
                document.getElementById('checklist-header').style.display = 'block';
            }
        }

        // --- 4. è¡Œç¨‹è¡¨æ¸²æŸ“ (å« Memo) ---
        function renderSchedule() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = '';
            // ç¢ºä¿ itinerary ç‰©ä»¶å­˜åœ¨
            if (!appData.itinerary) appData.itinerary = {};
            const dayList = appData.itinerary[currentDay] || [];

            dayList.forEach((item, index) => {
                let cleanLoc = item.loc ? item.loc.replace(/ğŸ“|ğŸš—|ğŸš„|âœˆï¸/g, '').trim() : "";
                let mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(cleanLoc)}`;
                
                // Memo é¡¯ç¤ºé‚è¼¯ï¼šæœ‰å…§å®¹é¡¯ç¤ºï¼Œæˆ–è€…æ˜¯ç·¨è¼¯æ¨¡å¼ä¸‹é¡¯ç¤º
                let memoContent = item.memo || "";
                let hasMemo = memoContent.length > 0;
                let memoDisplayClass = hasMemo ? "show" : "";

                const div = document.createElement('div');
                div.className = 'timeline-item';
                div.innerHTML = `
                    <div class="card">
                        <div class="delete-btn" onclick="deleteItem(${index})"><i class="fas fa-times"></i></div>
                        <div class="card-main">
                            <div class="time-box">
                                <div class="ampm" onblur="updateItinerary(${index}, 'ampm', this.innerText)">${item.ampm}</div>
                                <div class="time" onblur="updateItinerary(${index}, 'time', this.innerText)">${item.time}</div>
                            </div>
                            <div class="info-box">
                                <div class="info-title" onblur="updateItinerary(${index}, 'title', this.innerText)">${item.title}</div>
                                <div class="loc-wrapper">
                                    <div class="info-loc" onblur="updateItinerary(${index}, 'loc', this.innerText)">${item.loc}</div>
                                    <a href="${mapUrl}" target="_blank" class="map-link"><i class="fas fa-location-arrow"></i> å°èˆª</a>
                                </div>
                                <div class="info-note" onblur="updateItinerary(${index}, 'note', this.innerText)">${item.note}</div>
                            </div>
                        </div>

                        <div class="memo-wrapper">
                            <div class="memo-controls">
                                ${!hasMemo ? `<div class="add-memo-btn" onclick="toggleMemo(${index}, true)">+ æ–°å¢å‚™å¿˜éŒ„</div>` : ''}
                                ${hasMemo ? `<div class="del-memo-btn" onclick="toggleMemo(${index}, false)"><i class="fas fa-trash"></i> åˆªé™¤å‚™å¿˜</div>` : ''}
                            </div>
                            <div class="memo-section ${memoDisplayClass}" onblur="updateItinerary(${index}, 'memo', this.innerText)">${memoContent}</div>
                        </div>
                    </div>`;
                container.appendChild(div);
            });
            setEditable(isEditing);
        }

        function updateItinerary(index, key, value) {
            if (!appData.itinerary[currentDay][index]) return;
            appData.itinerary[currentDay][index][key] = value.trim();
            saveData();
        }

        function toggleMemo(index, show) {
            if (!appData.itinerary[currentDay][index]) return;
            if (show) {
                appData.itinerary[currentDay][index].memo = "è«‹è¼¸å…¥å‚™å¿˜äº‹é …...";
            } else {
                appData.itinerary[currentDay][index].memo = "";
            }
            saveData();
            renderSchedule();
        }

        // --- 5. æª¢æŸ¥æ¸…å–®æ¸²æŸ“ ---
        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';
            
            appData.checklist.forEach((cat, catIndex) => {
                const catDiv = document.createElement('div');
                catDiv.className = 'checklist-category';
                
                let itemsHtml = '';
                cat.items.forEach((item, itemIndex) => {
                    itemsHtml += `
                        <div class="check-item ${item.checked ? 'checked' : ''}">
                            <div class="custom-checkbox" onclick="toggleCheck(${catIndex}, ${itemIndex})">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="item-text" onblur="updateCheckItem(${catIndex}, ${itemIndex}, this.innerText)">${item.text}</div>
                            <div class="del-check-btn" onclick="deleteCheckItem(${catIndex}, ${itemIndex})"><i class="fas fa-minus-circle"></i></div>
                        </div>
                    `;
                });

                catDiv.innerHTML = `
                    <div class="cat-title">
                        <span onblur="updateCatTitle(${catIndex}, this.innerText)">${cat.category}</span>
                    </div>
                    <div class="cat-items">${itemsHtml}</div>
                    <div class="add-check-row">
                        <div class="add-check-btn" onclick="addCheckItem(${catIndex})">+ æ–°å¢é …ç›®</div>
                    </div>
                `;
                container.appendChild(catDiv);
            });
            setEditable(isEditing);
        }

        function toggleCheck(catIndex, itemIndex) {
            if(isEditing) return; // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸çµ¦æ‰“å‹¾ï¼Œé¿å…èª¤è§¸
            appData.checklist[catIndex].items[itemIndex].checked = !appData.checklist[catIndex].items[itemIndex].checked;
            saveData();
            renderChecklist();
        }
        
        function updateCheckItem(catIndex, itemIndex, value) {
            appData.checklist[catIndex].items[itemIndex].text = value.trim();
            saveData();
        }

        function addCheckItem(catIndex) {
            appData.checklist[catIndex].items.push({ text: "æ–°é …ç›®", checked: false });
            saveData();
            renderChecklist();
        }

        function deleteCheckItem(catIndex, itemIndex) {
            if(confirm('åˆªé™¤æ­¤é …ç›®ï¼Ÿ')) {
                appData.checklist[catIndex].items.splice(itemIndex, 1);
                saveData();
                renderChecklist();
            }
        }

        // --- 6. é€šç”¨åŠŸèƒ½ ---
        function switchDay(dayId, btn) {
            currentDay = dayId;
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            renderSchedule();
        }

        // --- ä¿®æ”¹å¾Œçš„ç·¨è¼¯åˆ‡æ›åŠŸèƒ½ (å«å¯†ç¢¼é–) ---
        function toggleEditMode() {
            // å¦‚æœç›®å‰æ˜¯ç€è¦½æ¨¡å¼ï¼Œæƒ³è¦é€²å…¥ç·¨è¼¯æ¨¡å¼ -> æª¢æŸ¥å¯†ç¢¼
            if (!isEditing) {
                // â˜… é€™è£¡è¨­å®šæ‚¨çš„å¯†ç¢¼ï¼Œä¾‹å¦‚ "8888" â˜…
                const myPassword = "8888"; 
                
                // æª¢æŸ¥æ˜¯å¦å·²ç¶“è¼¸å…¥éå¯†ç¢¼ (æœ¬æ¬¡ç€è¦½æœŸé–“)
                if (!sessionStorage.getItem('isAuth')) {
                    const input = prompt("è«‹è¼¸å…¥ç·¨è¼¯å¯†ç¢¼ï¼Œæ‰èƒ½ä¿®æ”¹è¡Œç¨‹ï¼š");
                    if (input !== myPassword) {
                        alert("å¯†ç¢¼éŒ¯èª¤ï¼æ‚¨åªèƒ½ç€è¦½ï¼Œä¸èƒ½ç·¨è¼¯å–” ğŸ™…â€â™‚ï¸");
                        return; // å¯†ç¢¼éŒ¯å°±åœæ­¢ï¼Œä¸åˆ‡æ›æ¨¡å¼
                    }
                    // å¯†ç¢¼å°äº†ï¼Œæš«å­˜èµ·ä¾†ï¼Œä¸ç”¨ä¸€ç›´è¼¸å…¥
                    sessionStorage.setItem('isAuth', 'true');
                }
            }

            // åŸ·è¡ŒåŸæœ¬çš„åˆ‡æ›é‚è¼¯
            isEditing = !isEditing;
            const btnText = document.getElementById('editBtnText');
            const toggleBtn = document.querySelector('.edit-toggle');
            document.body.classList.toggle('is-editing', isEditing);
            toggleBtn.classList.toggle('editing', isEditing);
            btnText.innerText = isEditing ? 'å®Œæˆ' : 'ç·¨è¼¯';
            setEditable(isEditing);
            renderSchedule(); 
            renderChecklist();
        }

        function setEditable(editable) {
            // è¡Œç¨‹è¡¨æ¬„ä½
            document.querySelectorAll('.time, .info-title, .info-loc, .info-note, .ampm, .memo-section').forEach(field => {
                field.contentEditable = editable;
            });
            // æ¸…å–®æ¬„ä½
            document.querySelectorAll('.item-text, .cat-title span').forEach(field => {
                field.contentEditable = editable;
            });
        }

        function addNewItem() {
            if (!appData.itinerary[currentDay]) appData.itinerary[currentDay] = [];
            appData.itinerary[currentDay].push({ id: Date.now(), ampm: "æ™‚æ®µ", time: "00:00", title: "æ–°è¡Œç¨‹", loc: "åœ°é»", note: "å‚™è¨»", memo: "" });
            saveData(); renderSchedule();
        }

        function deleteItem(index) {
            if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                appData.itinerary[currentDay].splice(index, 1);
                saveData(); renderSchedule();
            }
        }

        function showToast() {
            const toast = document.getElementById('save-toast');
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2000);
        }
    </script>
</body>
</html>
